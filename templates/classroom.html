{% extends "base.html" %}
{% block content %}
<div class="classroom">

  <!-- Session Header -->
  <div class="session-header">
    <div class="header-content">
      <h1>Virtual Classroom</h1>
      <p class="session-info">
        Session ID: <strong>{{ code }}</strong>
      </p>
      <div class="session-time">
        <span class="material-icons">schedule</span>
        <span id="sessionTimer">00:00:00</span>
      </div>
    </div>
    <div class="user-status">
      <div class="avatar">
        <img
          src="https://ui-avatars.com/api/?name=User&background=4B66F5&color=fff"
          alt="User Avatar"
        />
      </div>
      <div class="user-info">
        <span class="username">Student</span>
        <div class="status-indicator">
          <span class="status-dot"></span>
          <span id="statusText">Active</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content Area -->
  <main class="main-content">
    <!-- Top Row: Video & Analytics -->
    <div class="dashboard">
      <!-- Video Feed (Left) -->
      <div class="detection-container">
        <div class="video-wrapper">
          <div class="video-container">
            <img
              src="{{ url_for('video_feed') }}"
              id="liveFeed"
              class="video-feed"
              alt="Live Camera Feed"
            />
            <div class="video-overlay">
              <div class="overlay-item">
                <span class="material-icons">visibility</span>
                <span id="eyeStatus">Detecting</span>
              </div>
              <div class="overlay-item">
                <span class="material-icons">hearing</span>
                <span id="audioStatus">Active</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Analytics Panel (Right) -->
      <div class="analytics-panel">
        <div class="analytics-header">
          <h2>
            <span class="material-icons">analytics</span> Session Analytics
          </h2>
          <div class="engagement-score">
            <div class="score-value" id="overallEngagement">87%</div>
            <div class="score-label">Engagement</div>
          </div>
        </div>

        <div class="metrics-grid">
          <!-- Core Metrics -->
          <div class="metric-card">
            <div class="metric-header">
              <span class="material-icons">emoji_people</span>
              <span class="metric-title">Engagement</span>
            </div>
            <div class="metric-content">
              <div class="metric-value" id="engagementVal">N/A</div>
              <div class="metric-trend">
                <span class="material-icons">trending_up</span>
                <span>Improving</span>
              </div>
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-header">
              <span class="material-icons">remove_red_eye</span>
              <span class="metric-title">Eye Attention</span>
            </div>
            <div class="metric-content">
              <div class="metric-value" id="earVal">N/A</div>
              <div class="gauge-container">
                <div class="gauge">
                  <div class="gauge-fill" id="earGauge"></div>
                </div>
                <div class="gauge-labels">
                  <span>Low</span>
                  <span>High</span>
                </div>
              </div>
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-header">
              <span class="material-icons">visibility</span>
              <span class="metric-title">Blinks</span>
            </div>
            <div class="metric-content">
              <div class="metric-value" id="blinksVal">N/A</div>
              <div class="blink-history">
                <div class="blink-dot active"></div>
                <div class="blink-dot"></div>
                <div class="blink-dot active"></div>
                <div class="blink-dot"></div>
                <div class="blink-dot active"></div>
              </div>
            </div>
          </div>

          <!-- Secondary Metrics -->
          <div class="metric-card">
            <div class="metric-header">
              <span class="material-icons">directions</span>
              <span class="metric-title">Head Position</span>
            </div>
            <div class="metric-content">
              <div class="metric-value" id="headPosVal">N/A</div>
              <div class="metric-visual">
                <div class="head-pose-indicator">
                  <div class="pose-dot"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-header">
              <span class="material-icons">volume_up</span>
              <span class="metric-title">Noise Level</span>
            </div>
            <div class="metric-content">
              <div class="metric-value" id="noiseVal">N/A</div>
              <div class="noise-visualizer">
                <div class="bar" id="noiseBar1"></div>
                <div class="bar" id="noiseBar2"></div>
                <div class="bar" id="noiseBar3"></div>
                <div class="bar" id="noiseBar4"></div>
                <div class="bar" id="noiseBar5"></div>
              </div>
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-header">
              <span class="material-icons">sentiment_satisfied</span>
              <span class="metric-title">Sentiment</span>
            </div>
            <div class="metric-content">
              <div class="metric-value" id="sentimentVal">Positive</div>
              <div class="sentiment-emoji">😊</div>
            </div>
          </div>

          <!-- Performance Metrics -->
          <div class="metric-card">
            <div class="metric-header">
              <span class="material-icons">speed</span>
              <span class="metric-title">Performance (FPS)</span>
            </div>
            <div class="metric-content">
              <div class="metric-value" id="fpsVal">N/A</div>
              <div class="performance-bars">
                <div class="bar" style="height: 70%"></div>
                <div class="bar" style="height: 85%"></div>
                <div class="bar" style="height: 65%"></div>
                <div class="bar" style="height: 90%"></div>
                <div class="bar" style="height: 75%"></div>
              </div>
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-header">
              <span class="material-icons">mouse</span>
              <span class="metric-title">Activity</span>
            </div>
            <div class="metric-content">
              <div class="metric-value" id="clickCount">0</div>
              <div class="activity-indicator">
                <div class="activity-dot"></div>
                <span>Active now</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Control Panel (Bottom) -->
    <div class="control-panel">
      <!-- Media Controls -->
      <div class="control-group">
        <button id="toggleVideo" class="control-btn">
          <span class="material-icons" id="videoIcon">videocam</span>
          <span id="videoText">Video</span>
        </button>
        <button id="toggleMic" class="control-btn">
          <span class="material-icons" id="micIcon">mic</span>
          <span id="micText">Mute Mic</span>
        </button>
        <button id="screenShare" class="control-btn">
          <span class="material-icons">screen_share</span>
          <span>Share Screen</span>
        </button>
      </div>

      <!-- Interaction Controls -->
      <div class="control-group">
        <button id="raiseHand" class="control-btn">
          <span class="material-icons">back_hand</span>
          <span>Raise Hand</span>
        </button>
        <button id="takeNotes" class="control-btn">
          <span class="material-icons">note_add</span>
          <span>Take Notes</span>
        </button>
        <button id="askQuestion" class="control-btn">
          <span class="material-icons">question_answer</span>
          <span>Ask Question</span>
        </button>
      </div>

      <!-- System Controls -->
      <div class="control-group">
        <button id="exportResults" class="control-btn">
          <span class="material-icons">file_download</span>
          <span>Export Results</span>
        </button>
        <button id="settingsBtn" class="control-btn">
          <span class="material-icons">settings</span>
          <span>Settings</span>
        </button>
        <button id="exitSession" class="control-btn exit-btn">
          <span class="material-icons">exit_to_app</span>
          <span>Leave Meeting</span>
        </button>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <span>&copy; 2025 E-Learn Engagement System</span>
      <div class="system-info">
        <span>v2.5.1</span>
        <span>•</span>
        <span id="connectionStatus">Connected</span>
        <span>•</span>
        <span>Bandwidth: <span id="bandwidth">4.2 Mbps</span></span>
      </div>
    </div>
  </footer>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.1/socket.io.min.js"></script>
<script>
  // ===========================================================================  
  //  SOCKET & METRICS LOGIC  
  // ===========================================================================  
  const socket = io.connect('http://' + document.domain + ':' + location.port);
  let lastActivity = Date.now();
  let engaged = true;
  let clickCount = 0;
  let sessionStartTime = Date.now();
  let audioContext, analyser, microphone, javascriptNode;
  let micMuted = false;
  let videoActive = true;

  // 1) SESSION TIMER  
  function updateSessionTimer() {
    const elapsed = Date.now() - sessionStartTime;
    const hrs = Math.floor(elapsed / 3600000);
    const mins = Math.floor((elapsed % 3600000) / 60000);
    const secs = Math.floor((elapsed % 60000) / 1000);
    const formatted =
      String(hrs).padStart(2, '0') + ':' +
      String(mins).padStart(2, '0') + ':' +
      String(secs).padStart(2, '0');
    document.getElementById('sessionTimer').textContent = formatted;
  }
  setInterval(updateSessionTimer, 1000);

  // 2) ENGAGEMENT & ACTIVITY  
  function sendEngagementState(state) {
    socket.emit('update_engagement', { engagement: state ? "Engaged" : "Inactive" });
    document.getElementById('overallEngagement').textContent = state ? "Engaged" : "Inactive";
  }

  function markActive(eventType) {
    engaged = true;
    lastActivity = Date.now();
    sendEngagementState(true);
    document.getElementById('statusText').textContent = "Active";
    document.querySelector('.status-dot').style.backgroundColor = "#34D399";

    if (["click", "mousedown", "touchstart"].includes(eventType)) {
      clickCount++;
      document.getElementById('clickCount').textContent = clickCount;
      socket.emit('update_clicks', { clicks: clickCount });
      const indicator = document.querySelector('.activity-indicator');
      indicator.style.opacity = 1;
      setTimeout(() => indicator.style.opacity = 0.7, 1000);
    }
  }

  setInterval(() => {
    if (Date.now() - lastActivity > 5000) {
      engaged = false;
      document.getElementById('statusText').textContent = "Away";
      document.querySelector('.status-dot').style.backgroundColor = "#EF4444";
      sendEngagementState(false);
    }
  }, 1000);

  document.addEventListener('mousemove', () => markActive("mousemove"));
  document.addEventListener('click', () => markActive("click"));
  document.addEventListener('mousedown', () => markActive("mousedown"));
  document.addEventListener('touchstart', () => markActive("touchstart"));

  // 3) FETCH & UPDATE METRICS EVERY 500ms  
  function updateMetricsUI(data) {
    // Engagement value + color  
    const engEl = document.getElementById('engagementVal');
    engEl.textContent = data.engagement;
    engEl.className = `metric-value ${data.engagement === "Engaged" ? "engaged" : "not-engaged"}`;

    // Head Pose  
    document.getElementById('headPosVal').textContent =
      `P:${data.pitch}° Y:${data.yaw}° R:${data.roll}°`;

    // EAR Gauge  
    const earVal = parseFloat(data.ear) || 0;
    const earPct = Math.min(100, Math.max(0, (earVal - 0.15) / 0.15 * 100));
    document.getElementById('earGauge').style.width = `${earPct}%`;
    document.getElementById('earVal').textContent = data.ear;

    // Blinks  
    document.getElementById('blinksVal').textContent = data.blinks;

    // FPS  
    document.getElementById('fpsVal').textContent = data.fps;
  }

  setInterval(() => {
    fetch("{{ url_for('metrics') }}", { cache: "no-store" })
      .then(r => r.json())
      .then(updateMetricsUI)
      .catch(console.error);
  }, 500);

  // 4) NOISE LEVEL (Web Audio)  
  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
    navigator.mediaDevices.getUserMedia({ audio: true, video: false })
      .then(stream => {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioContext.createAnalyser();
        microphone = audioContext.createMediaStreamSource(stream);
        javascriptNode = audioContext.createScriptProcessor(2048, 1, 1);

        analyser.smoothingTimeConstant = 0.8;
        analyser.fftSize = 1024;

        microphone.connect(analyser);
        analyser.connect(javascriptNode);
        javascriptNode.connect(audioContext.destination);

        javascriptNode.onaudioprocess = () => {
          if (micMuted) {
            document.getElementById('noiseVal').textContent = "Muted";
            document.getElementById('audioStatus').textContent = "Muted";
            return;
          }
          document.getElementById('audioStatus').textContent = "Active";

          const freqData = new Uint8Array(analyser.frequencyBinCount);
          analyser.getByteFrequencyData(freqData);
          let sum = 0;
          for (let i = 0; i < freqData.length; i++) sum += freqData[i];
          const avg = sum / freqData.length;
          document.getElementById('noiseVal').textContent = avg.toFixed(2);
          sendNoiseLevel(avg);
        };
      })
      .catch(err => {
        console.error("Microphone error:", err);
        document.getElementById('noiseVal').textContent = "Error";
        document.getElementById('audioStatus').textContent = "Error";
      });
  } else {
    document.getElementById('noiseVal').textContent = "N/A";
    document.getElementById('audioStatus').textContent = "N/A";
  }

  function sendNoiseLevel(val) {
    socket.emit('update_noise', { noise: val });
    const noise = Math.min(100, Math.max(0, val));
    const bars = document.querySelectorAll('.noise-visualizer .bar');
    const heightPct = Math.min(100, Math.floor(noise / 20 * 100));
    bars.forEach((bar, idx) => {
      const h = Math.max(10, heightPct - (idx * 15));
      bar.style.height = `${h}%`;
    });
  }

  // 5) VIDEO TOGGLE  
  const liveFeed = document.getElementById('liveFeed');
  const toggleVideoBtn = document.getElementById('toggleVideo');
  const videoIcon = document.getElementById('videoIcon');
  const videoText = document.getElementById('videoText');

  toggleVideoBtn.addEventListener('click', () => {
    if (videoActive) {
      fetch("{{ url_for('stop_camera') }}", { method: "POST" })
        .then(res => res.json())
        .then(() => {
          liveFeed.src = "";
          videoIcon.textContent = "videocam_off";
          videoText.textContent = "Start Video";
          videoActive = false;
          document.getElementById('eyeStatus').textContent = "Disabled";
        });
    } else {
      fetch("{{ url_for('start_camera') }}", { method: "POST" })
        .then(res => res.json())
        .then(() => {
          liveFeed.src = "{{ url_for('video_feed') }}";
          videoIcon.textContent = "videocam";
          videoText.textContent = "Stop Video";
          videoActive = true;
          document.getElementById('eyeStatus').textContent = "Detecting";
        });
    }
  });

  // 6) MIC TOGGLE  
  const toggleMicBtn = document.getElementById('toggleMic');
  const micIcon = document.getElementById('micIcon');
  const micText = document.getElementById('micText');

  toggleMicBtn.addEventListener('click', () => {
    micMuted = !micMuted;
    if (micMuted) {
      micIcon.textContent = "mic_off";
      micText.textContent = "Unmute Mic";
      document.getElementById('audioStatus').textContent = "Muted";
    } else {
      micIcon.textContent = "mic";
      micText.textContent = "Mute Mic";
      document.getElementById('audioStatus').textContent = "Active";
    }
  });

  // 7) EXPORT RESULTS  
  document.getElementById('exportResults').addEventListener('click', () => {
    fetch("{{ url_for('exportresult') }}", { method: "POST" })
      .then(res => res.json())
      .then(data => {
        if (data.status) {
          const notif = document.createElement('div');
          notif.className = 'notification success';
          notif.innerHTML = `
            <span class="material-icons">check_circle</span>
            <span>${data.status}</span>
          `;
          document.body.appendChild(notif);
          setTimeout(() => {
            notif.style.opacity = 0;
            setTimeout(() => notif.remove(), 300);
          }, 3000);
        } else if (data.error) {
          alert("Error exporting results: " + data.error);
        }
      })
      .catch(console.error);
  });

  // 8) LEAVE SESSION  
  document.getElementById('exitSession').addEventListener('click', () => {
    window.location.href = "{{ url_for('exportresult') }}";
  });

  // 9) RAISE HAND  
  document.getElementById('raiseHand').addEventListener('click', () => {
    const notif = document.createElement('div');
    notif.className = 'notification info';
    notif.innerHTML = `
      <span class="material-icons">info</span>
      <span>Hand raised! Instructor notified.</span>
    `;
    document.body.appendChild(notif);
    setTimeout(() => {
      notif.style.opacity = 0;
      setTimeout(() => notif.remove(), 300);
    }, 3000);
  });

  // 10) TAKE NOTES  
  document.getElementById('takeNotes').addEventListener('click', () => {
    alert("Note-taking feature will open in a new window.");
  });

  // 11) ASK QUESTION  
  document.getElementById('askQuestion').addEventListener('click', () => {
    const question = prompt("Enter your question for the instructor:");
    if (question) {
      const notif = document.createElement('div');
      notif.className = 'notification info';
      notif.innerHTML = `
        <span class="material-icons">question_answer</span>
        <span>Question sent to instructor!</span>
      `;
      document.body.appendChild(notif);
      setTimeout(() => {
        notif.style.opacity = 0;
        setTimeout(() => notif.remove(), 300);
      }, 3000);
    }
  });
</script>

<style>
  /* ======================================================
     Ensure full‐screen layout, optimized positioning only. 
     Colors, fonts, and button styles remain unchanged.
     ====================================================== */

  /* 1) Make <div.classroom> span full viewport height */
  .classroom {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    background: linear-gradient(135deg, #f5f7fa 0%, #e4e7f1 100%);
  }

  .session-header {
    flex: 0 0 auto;
    z-index: 100;
  }

  .main-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 0;
  }

  .dashboard {
    display: flex;
    flex: 1;
    gap: 1.5rem;
    padding: 1.5rem;
    max-width: 1800px;
    margin: 0 auto;
    width: 100%;
    height: calc(100vh - 180px);
  }

  .detection-container {
    flex: 3;
    display: flex;
    flex-direction: column;
  }

  .video-wrapper {
    flex: 1;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
  }

  .analytics-panel {
    flex: 2;
    display: flex;
    flex-direction: column;
    height: 100%;
    min-width: 400px;
    max-width: 600px;
  }

  .metrics-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
    height: 100%;
    overflow-y: auto;
    padding: 1rem;
  }

  .control-panel {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 1.5rem;
    padding: 1rem 2rem;
    background: white;
    border-top: 1px solid #eaeef5;
    box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.05);
  }

  .control-group {
    display: flex;
    gap: 1rem;
  }

  /* Responsive adjustments */
  @media (max-width: 1200px) {
    .dashboard {
      flex-direction: column;
      height: auto;
    }
    .analytics-panel {
      max-width: 100%;
      min-width: auto;
    }
  }

  @media (max-width: 768px) {
    .metrics-grid {
      grid-template-columns: 1fr;
    }
    .control-group {
      flex-wrap: wrap;
      justify-content: center;
    }
  }

  /* ==================== EXISTING STYLES (OPTIMIZED) ==================== */

  .session-header {
    background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-dark) 100%);
    color: white;
    padding: 1.5rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: var(--shadow-md);
  }

  .header-content h1 {
    font-family: 'Poppins', sans-serif;
    font-weight: 700;
    font-size: 1.8rem;
    margin-bottom: 0.5rem;
  }

  .session-info {
    font-size: 1rem;
    opacity: 0.9;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .session-info strong {
    font-weight: 600;
    background: rgba(255, 255, 255, 0.2);
    padding: 0.2rem 0.8rem;
    border-radius: 20px;
  }

  .session-time {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1.1rem;
    margin-top: 0.5rem;
    font-weight: 500;
  }

  .user-status {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    overflow: hidden;
    border: 3px solid rgba(255, 255, 255, 0.3);
  }

  .avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .user-info {
    display: flex;
    flex-direction: column;
  }

  .username {
    font-weight: 500;
    font-size: 1.1rem;
  }

  .status-indicator {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    opacity: 0.9;
  }

  .status-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background-color: var(--accent-green);
  }

  /* ---------------------------------------------------------
     Video & Overlay Styles
     --------------------------------------------------------- */
  .detection-container {
    background: var(--card-bg);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: var(--shadow-lg);
  }

  .video-wrapper {
    position: relative;
    width: 100%;
    padding-top: 56.25%; /* 16:9 aspect ratio */
  }

  .video-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #000;
  }

  .video-feed {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .video-overlay {
    position: absolute;
    bottom: 1rem;
    left: 1rem;
    display: flex;
    gap: 1rem;
  }

  .overlay-item {
    background: rgba(0, 0, 0, 0.6);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
  }

  /* ---------------------------------------------------------
     Analytics Panel Styles
     --------------------------------------------------------- */
  .analytics-panel {
    background: var(--card-bg);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: var(--shadow-lg);
    display: flex;
    flex-direction: column;
  }

  .analytics-header {
    padding: 1.5rem;
    background: var(--primary-blue);
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .analytics-header h2 {
    font-family: 'Poppins', sans-serif;
    font-weight: 600;
    font-size: 1.4rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .engagement-score {
    text-align: center;
  }

  .score-value {
    font-family: 'Poppins', sans-serif;
    font-weight: 700;
    font-size: 2rem;
    line-height: 1;
  }

  .score-label {
    font-size: 0.9rem;
    opacity: 0.9;
  }

  .metrics-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
    flex: 1 1 auto;
    overflow-y: auto;
    padding: 1.5rem;
  }

  @media (max-width: 768px) {
    .metrics-grid {
      grid-template-columns: 1fr;
    }
  }

  .metric-card {
    background: var(--bg-light);
    border-radius: 10px;
    padding: 1.2rem;
    transition: var(--transition);
  }

  .metric-card:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow-sm);
  }

  .metric-header {
    display: flex;
    align-items: center;
    gap: 0.7rem;
    margin-bottom: 1rem;
  }

  .metric-title {
    font-family: 'Poppins', sans-serif;
    font-weight: 500;
    font-size: 1rem;
    color: var(--text-dark);
  }

  .metric-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .metric-value {
    font-family: 'Poppins', sans-serif;
    font-weight: 600;
    font-size: 1.4rem;
  }

  .metric-value.engaged {
    color: var(--accent-green);
  }

  .metric-value.not-engaged {
    color: var(--accent-red);
  }

  .metric-trend {
    display: flex;
    align-items: center;
    gap: 0.3rem;
    font-size: 0.9rem;
    color: var(--accent-green);
    font-weight: 500;
  }

  .head-pose-indicator {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 2px solid var(--border-color);
    position: relative;
  }

  .pose-dot {
    position: absolute;
    width: 10px;
    height: 10px;
    background: var(--primary-blue);
    border-radius: 50%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }

  .gauge-container {
    width: 80px;
  }

  .gauge {
    height: 8px;
    background: var(--border-color);
    border-radius: 4px;
    overflow: hidden;
  }

  .gauge-fill {
    height: 100%;
    background: var(--accent-green);
    width: 0%;
    border-radius: 4px;
    transition: width 0.3s ease;
  }

  .gauge-labels {
    display: flex;
    justify-content: space-between;
    font-size: 0.7rem;
    color: var(--text-light);
    margin-top: 0.3rem;
  }

  .blink-history {
    display: flex;
    gap: 0.3rem;
  }

  .blink-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--border-color);
  }

  .blink-dot.active {
    background: var(--primary-blue);
  }

  .performance-bars {
    display: flex;
    align-items: flex-end;
    gap: 3px;
    height: 30px;
    width: 60px;
  }

  .performance-bars .bar {
    width: 6px;
    background: var(--primary-blue);
    border-radius: 3px 3px 0 0;
  }

  .noise-visualizer {
    display: flex;
    align-items: flex-end;
    gap: 3px;
    height: 30px;
    width: 60px;
  }

  .noise-visualizer .bar {
    width: 8px;
    background: var(--primary-blue);
    border-radius: 4px 4px 0 0;
    transition: height 0.2s;
  }

  .activity-indicator {
    display: flex;
    align-items: center;
    gap: 0.3rem;
    font-size: 0.8rem;
    color: var(--text-light);
    transition: opacity 0.3s;
    opacity: 0.7;
  }

  .activity-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--accent-green);
  }

  .sentiment-emoji {
    font-size: 1.5rem;
  }

  /* ---------------------------------------------------------
     Control Panel Styles
     --------------------------------------------------------- */
  .control-panel {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 1.5rem;
    padding: 1rem 2rem;
    max-width: 1800px;
    margin: 0 auto;
    width: 100%;
    background: transparent;
    box-shadow: 0 -1px 4px rgba(0, 0, 0, 0.05);
  }

  .control-group {
    display: flex;
    gap: 1rem;
  }

  .control-btn {
    padding: 0.8rem 1.5rem;
    border: none;
    border-radius: 30px;
    background: var(--card-bg);
    color: var(--text-dark);
    display: flex;
    align-items: center;
    gap: 0.7rem;
    cursor: pointer;
    transition: var(--transition);
    box-shadow: var(--shadow-sm);
    font-family: 'Poppins', sans-serif;
    font-weight: 500;
    font-size: 1rem;
  }

  .control-btn:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow-md);
    background: var(--primary-blue);
    color: white;
  }

  .control-btn:hover .material-icons {
    color: white;
  }

  .exit-btn {
    background: var(--accent-red);
    color: white;
  }

  .exit-btn:hover {
    background: #DC2626;
  }

  /* ---------------------------------------------------------
     Footer Styles
     --------------------------------------------------------- */
  .footer {
    background: var(--card-bg);
    padding: 1.2rem 2rem;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
  }

  .footer-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 1800px;
    margin: 0 auto;
    font-size: 0.9rem;
    color: var(--text-light);
  }

  .system-info {
    display: flex;
    align-items: center;
    gap: 0.7rem;
  }

  /* ---------------------------------------------------------
     Notification Styles
     --------------------------------------------------------- */
  .notification {
    position: fixed;
    top: 1rem;
    right: 1rem;
    padding: 1rem 1.5rem;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 0.8rem;
    z-index: 1000;
    box-shadow: var(--shadow-lg);
    transition: opacity 0.3s;
  }

  .notification.success {
    background: var(--accent-green);
    color: white;
  }

  .notification.info {
    background: var(--primary-blue);
    color: white;
  }
</style>
{% endblock %}
